!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("loco-js-model")):"function"==typeof define&&define.amd?define(["loco-js-model"],n):"object"==typeof exports?exports.Loco=n(require("loco-js-model")):t.Loco=n(t.LocoModel)}(self,(function(t){return(()=>{var n={998:t=>{window,t.exports=function(t){var n={};function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(o,r,function(n){return t[n]}.bind(null,r));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}e.r(n),e.d(n,"init",(function(){return l})),e.d(n,"helpers",(function(){return a}));var r=function(t){"function"==typeof t.constructor.initialize&&t.constructor.initialize(),"function"==typeof t.initialize&&t.initialize()},i=function(t,n,e){var r=void 0===e?t[n]:t[n][e];return"function"==typeof r?new r:"object"===o(r)?r:null},l=function(t){var n=document.getElementsByTagName("body")[0],e=n.getAttribute("data-namespace"),o=n.getAttribute("data-controller"),l=n.getAttribute("data-action"),c=i(t,e),u=i(t,o);return null!==c&&(u=i(t,e,o),c.controller=u,r(c)),null!==u&&(u.namespaceController=c,function(t,n){r(t),"function"==typeof t.constructor[n]&&t.constructor[n](),"function"==typeof t[n]&&t[n]()}(u,l)),{namespaceController:c,controller:u,action:l}};function c(t,n){var e;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return u(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?u(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,c=!1;return{s:function(){e=t[Symbol.iterator]()},n:function(){var t=e.next();return l=t.done,t},e:function(t){c=!0,i=t},f:function(){try{l||null==e.return||e.return()}finally{if(c)throw i}}}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}var a={get params(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href,n={},e=/https?:\/\/.+\/\w+\/(\d+)/.exec(t),o=null!==e?e[1]:null;null!==o&&(n.id=parseInt(o));var r=t.split("?");if(1===r.length)return n;var i,l=r[r.length-1].split("&").map((function(t){return t.split("=")})),u=c(l);try{for(u.s();!(i=u.n()).done;){var a=i.value,s=decodeURIComponent(a[0]),f=decodeURIComponent(a[1]);"string"==typeof f&&(f=f.replace(/\+/g," ")),n[s]=f}}catch(t){u.e(t)}finally{u.f()}return n}()}}}])},854:n=>{"use strict";n.exports=t}},e={};function o(t){var r=e[t];if(void 0!==r)return r.exports;var i=e[t]={exports:{}};return n[t](i,i.exports,o),i.exports}o.d=(t,n)=>{for(var e in n)o.o(n,e)&&!o.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:n[e]})},o.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";o.r(r),o.d(r,{Controllers:()=>l,Env:()=>t,I18n:()=>e.I18n,Models:()=>e.Models,Validators:()=>e.Validators,connector:()=>k,emit:()=>O,getLine:()=>j,getLocale:()=>T,getWire:()=>M,helpers:()=>n.helpers,init:()=>_,setLocale:()=>C,subscribe:()=>x});const t={loco:null,namespaceController:null,controller:null,action:null};var n=o(998),e=o(854);function i(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l={Base:function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,o;return n=t,(o=[{key:"setScope",value:function(t){e.Config.scope=t}},{key:"setResource",value:function(t){this.setScope(t)}}])&&i(n.prototype,o),t}()},c={cable:null,NotificationCenter:null};const u=function(){function t(){}return t.toURIParams=function(t){var n,e,o;for(n in e="",t)o=t[n],""!==e&&(e+="&"),e+=n+"="+encodeURIComponent(o);return e},t}();var a=[];const s=function(t){return!!a.includes(t)||(a.unshift(t),a.length>100&&a.pop(),!1)};function f(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var o,r,i=[],l=!0,c=!1;try{for(e=e.call(t);!(l=(o=e.next()).done)&&(i.push(o.value),!n||i.length!==n);l=!0);}catch(t){c=!0,r=t}finally{try{l||null==e.return||e.return()}finally{if(c)throw r}}return i}}(t,n)||d(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=d(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return l=t.done,t},e:function(t){c=!0,i=t},f:function(){try{l||null==e.return||e.return()}finally{if(c)throw i}}}}function d(t,n){if(t){if("string"==typeof t)return y(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?y(t,n):void 0}}function y(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}var h=function(t,n,o,r,i){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;null===l&&(l=new r({id:t}));var c,u=p(e.IdentityMap.findConnected(i,t));try{for(u.s();!(c=u.n()).done;){var a=c.value;a(n,o)}}catch(t){u.e(t)}finally{u.f()}},m=function(t,n,o){var r,i=p(e.IdentityMap.imap[o].collection);try{for(i.s();!(r=i.n()).done;)(0,r.value)("".concat(o," ").concat(t),n)}catch(t){i.e(t)}finally{i.f()}};const v=function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.log&&console.log(n);var r=f(n,4),i=r[0],l=r[1],u=r[2],a=r[3];if(s(a.loco.idempotency_key))return!1;var p=t.loco.getModelForRemoteName(i),d=p.getIdentity();return null!=c.NotificationCenter&&c.NotificationCenter({type:"".concat(d," ").concat(u),payload:a}),void 0!==e.IdentityMap.imap[d]&&(void 0!==e.IdentityMap.imap[d][l]&&h(l,u,a,p,d),void 0!==e.IdentityMap.imap[d].collection&&0!==e.IdentityMap.imap[d].collection.length&&(m(u,a,d),!0))},g=function(){function n(t){var n,e,o,r;null==t&&(t={}),this.syncTime=null,this.token=null,this.pollingInterval=null,this.pollingTime=null!=(n=t.pollingTime)?n:3e3,this.log=!(null==t.log||!t.log),this.ssl=t.ssl,this.location=null!=(e=t.location)?e:"notification-center",this.size=null!=(o=t.size)?o:100,this.protocolWithHost=t.protocolWithHost,this.allowedDisconnectionTime=null!=(r=t.allowedDisconnectionTime)?r:10,this.disconnectedSinceTime=null,this.uuid=null}return n.prototype.setPollingTime=function(n){var e;if(this.pollingTime=n,!(null!=(e=t.loco.line)?e.connected:void 0))return this.disconnect(),this.connect()},n.prototype.connect=function(){return this.check(),this.pollingInterval=setInterval((n=this,function(){if(!t.loco.line.connected)return n.check();n.disconnect()}),this.pollingTime);var n},n.prototype.disconnect=function(){return window.clearInterval(this.pollingInterval)},n.prototype.check=function(){var t,n;if(0!==Object.keys(e.IdentityMap.imap).length||null!=this.token||null==this.syncTime)return(t=new XMLHttpRequest).open("GET",this._getURL()+"?"+u.toURIParams(this._requestParams())),t.onload=(n=this,function(t){var e,o,r,i,l;if(t.target.status>=200&&t.target.status<400){if(e=JSON.parse(t.target.response),n.disconnectedSinceTime=null,n.syncTime=e[1],0===(l=e[0]).length)return;for(o=0,r=l.length;o<r;o++)i=l[o],v(i,{log:n.log});if(l.length===n.size)return n.check()}else if(t.target.status>=500)return n._handleDisconnection()}),t.onerror=function(t){return function(){return t._handleDisconnection()}}(this),t.send()},n.prototype.fetchSyncTime=function(t){var n,e;return null==t&&(t={}),(n=new XMLHttpRequest).open("GET",this._getURL()+"/sync-time"),n.onerror=(e=this,function(){if(null!=t.after)return e[t.after]()}),n.onload=function(n){return function(e){var o;if(e.target.status>=200&&e.target.status<400){if(o=JSON.parse(e.target.response),n.syncTime=o.sync_time,null!=t.after)return n[t.after]()}else if(e.target.status>=500&&null!=t.after)return n[t.after]()}}(this),n.send()},n.prototype._requestParams=function(){var t;return t={synced_at:this.syncTime},null!=this.token&&(t.token=this.token),null!=this.uuid&&(t.uuid=this.uuid),t},n.prototype._getURL=function(){var t,n,e,o;return n=(e=window.location.href.split("/"))[0],e[1],t=e[2],null!=this.protocolWithHost&&(n=(o=this.protocolWithHost.split("//"))[0],t=o[1]),null!=this.ssl&&(n=this.ssl?"https:":"http:"),n+"//"+t+"/"+this.location},n.prototype._handleDisconnection=function(){var n,e,o;if(null==this.disconnectedSinceTime&&(this.disconnectedSinceTime=new Date),e=(new Date-this.disconnectedSinceTime)/1e3,n=null!=(o=t.namespaceController)?o:t.controller,e>this.allowedDisconnectionTime&&null!=n.disconnectedForTooLong)return n.disconnectedForTooLong(this.disconnectedSinceTime)},n}();function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}var S;S=function(){function n(){this.connected=!1,this.subscription=null}return n.prototype.connect=function(){return this.subscription=c.cable.subscriptions.create({channel:"Loco::NotificationCenterChannel"},{connected:(n=this,function(){return console.log("WS connected"),n.connected=!0,c.NotificationCenter({loco:"connected"}),n.pong()}),disconnected:function(n){return function(){var e;return console.log("WS disconnected"),n.connected=!1,null!=(e=t.loco.wire)&&(e.uuid=null,e.fetchSyncTime({after:"connect"})),c.NotificationCenter({loco:"disconnected"})}}(this),rejected:function(){return console.log("WS rejected"),c.NotificationCenter({loco:"rejected"})},received:function(n){return function(e){if(null!=e.loco){if(!function(t,n){var e=n.line,o=n.wire,r=n.processNotification;if(!0===t.ping&&e.pong(),null!=o)return"string"==typeof t.sync_time&&(o.syncTime=t.sync_time),"string"==typeof t.uuid&&(console.log("uuid: ".concat(t.uuid)),o.uuid=t.uuid),"object"===b(t.notification)&&"Array"===t.notification.constructor.name&&r(t.notification,{log:o.log}),"string"!=typeof t.idempotency_key||!s(t.idempotency_key)}(e.loco,{line:n,wire:t.loco.wire,processNotification:v}))return;delete e.loco}if(0!==Object.keys(e).length)return c.NotificationCenter(e)}}(this)});var n},n.prototype.send=function(t){return this.subscription.send(t)},n.prototype.pong=function(){return setTimeout((t=this,function(){return t.send({loco:{pong:!0}})}),3e3);var t},n}();const w=S,I=function(){function o(t){var n,e;null==t&&(t={}),this.wire=null,this.line=null,this.postInit=t.postInit,(n=null!=(e=t.notifications)?e:{}).protocolWithHost=t.protocolWithHost,this.notificationsParams=n}return o.prototype.init=function(o){return t.loco=this,this.initWire(),this.initLine(o.cable),this.ready((r=this,function(){var o;if(e.IdentityMap.clear(),o=(0,n.init)(l),t.namespaceController=o.namespaceController,t.controller=o.controller,t.action=o.action,null!=r.postInit)return r.postInit()}));var r},o.prototype.ready=function(t){return(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)},o.prototype.initWire=function(){var t;if(!1!==(null!=(t=this.notificationsParams)?t.enable:void 0))return this.wire=new g(this.notificationsParams),this.wire.fetchSyncTime({after:"connect"})},o.prototype.initLine=function(t){if(null!=t)return this.line=new w,this.line.connect()},o.prototype.emit=function(t){return this.line.send(t)},o.prototype.getModels=function(){var t,n,o,r,i;for(t in o=[],i=/^[A-Z]/,e.Models)if(e.Models[t],i.exec(t)&&"Base"!==t)for(n in o.push(t),r=e.Models[t])r[n],i.exec(n)&&o.push(t+"."+n);return o},o.prototype.getModelForRemoteName=function(t){var n,o,r,i;for(n=0,o=(i=this.getModels()).length;n<o;n++)if(1===(r=i[n].split(".")).length){if(e.Models[r[0]].getRemoteName()===t)return e.Models[r[0]]}else if(2===r.length&&e.Models[r[0]][r[1]].getRemoteName()===t)return e.Models[r[0]][r[1]]},o}();var T=function(){return e.Config.locale},C=function(t){return e.Config.locale=t},M=function(){return t.loco.wire},j=function(){return t.loco.line.subscription},O=function(n){return t.loco.emit(n)},_=function(t){for(var n=0,o=Object.keys(t.controllers||{});n<o.length;n++){var r=o[n];l[r]=t.controllers[r]}for(var i=0,u=Object.keys(t.models||{});i<u.length;i++){var a=u[i];e.Models[a]=t.models[a]}e.Config.locale=t.locale||"en",e.Config.protocolWithHost=t.protocolWithHost,e.Config.cookiesByCORS=t.cookiesByCORS||!1,c.cable=t.cable,c.NotificationCenter=t.notificationCenter,new I(t).init({cable:c.cable,protocolWithHost:e.Config.protocolWithHost})},k={getLocale:T,Env:t,I18n:e.I18n},x=e.IdentityMap.subscribe})(),r})()}));