window.App={Loco:null,IdentityMap:null,Wire:null,Env:{loco:null,namespaceController:null,controller:null,action:null,scope:null},Mix:null,Mixins:{},UI:{},Controllers:{},Models:{},Views:{},Services:{},Helpers:{},Presenters:{},Validators:{},I18n:{},Utils:{}};var slice=[].slice,extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Mix=function(){var t,e,r,n,o,i,s,a;for(e=arguments[0],i=2<=arguments.length?slice.call(arguments,1):[],t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return extend(e,t),e}(e),r=i.length-1;r>=0;r+=-1){o=i[r],a=o.prototype;for(s in a)n=a[s],t.prototype[s]=n}return t},App.IdentityMap=function(){function t(){}return t.imap={},t.clear=function(){return this.imap={}},t.add=function(t){var e;return e=t.getIdentity(),null==this.imap[e]&&(this.imap[e]={}),null==this.imap[e][t.id]&&(this.imap[e][t.id]=[]),this.imap[e][t.id][0]=t},t.connect=function(t,e){var r;return null==e&&(e={}),r=e["with"],this.add(r),this.imap[r.getIdentity()][r.id].push(t)},t.addCollection=function(t,e){return null==e&&(e={}),null==this.imap[t]&&(this.imap[t]={}),null==this.imap[t].collection&&(this.imap[t].collection=[]),-1===this.imap[t].collection.indexOf(e.to)?this.imap[t].collection.push(e.to):void 0},t.all=function(t){var e,r,n,o;if(null==this.imap[t])return null;e=[],o=this.imap[t];for(r in o)n=o[r],"collection"!==r&&e.push(n[0]);return e},t.find=function(t,e){return this.imap[t]&&this.imap[t][e]?this.imap[t][e][0]:null},t.findConnected=function(t,e){var r;return this.imap[t]&&this.imap[t][e]&&this.imap[t][e].length>1?(r=this.imap[t][e],r.slice(1,+(r.length-1)+1||9e9)):[]},t}(),App.Wire=function(){function t(t){var e,r,n,o;null==t&&(t={}),this.syncTime=null,this.token=null,this.pollingInterval=null,this.pollingTime=null!=(e=t.pollingTime)?e:3e3,this.log=!(null==t.log||!t.log),this.ssl=t.ssl,this.location=null!=(r=t.location)?r:"notification-center",this.size=null!=(n=t.size)?n:100,this.protocolWithHost=t.protocolWithHost,this.allowedDisconnectionTime=null!=(o=t.allowedDisconnectionTime)?o:10,this.disconnectedSinceTime=null}return t.prototype.setToken=function(t){return this.token=t},t.prototype.getSyncTime=function(){return this.syncTime},t.prototype.resetSyncTime=function(){return this.syncTime=null},t.prototype.getPollingTime=function(){return this.pollingTime},t.prototype.setPollingTime=function(t){return this.pollingTime=t,this.disableNotifications(),this.connect()},t.prototype.getPollingInterval=function(){return this.pollingInterval},t.prototype.getSSL=function(){return this.ssl},t.prototype.setSSL=function(t){return this.ssl=t},t.prototype.getLocation=function(){return this.location},t.prototype.setLocation=function(t){return this.location=t},t.prototype.getSize=function(){return this.size},t.prototype.setSize=function(t){return this.size=t},t.prototype.getAllowedDisconnectionTime=function(){return this.allowedDisconnectionTime},t.prototype.setAllowedDisconnectionTime=function(t){return this.allowedDisconnectionTime=t},t.prototype.connect=function(){return this.pollingInterval=setInterval(function(t){return function(){return t._check()}}(this),this.pollingTime)},t.prototype.disableNotifications=function(){return window.clearInterval(this.pollingInterval)},t.prototype._check=function(){var t;if(0!==Object.keys(App.IdentityMap.imap).length||null!=this.token||null==this.syncTime)return t=$.ajax({method:"GET",url:this._getURL(),data:this._requestParams()}),t.always(function(){}),t.fail(function(t){return function(){return t._handleDisconnection()}}(this)),t.done(function(t){return function(e){var r,n,o,i;if(t.disconnectedSinceTime=null,t.syncTime=e[1],i=e[0],0!==i.length){for(r=0,n=i.length;n>r;r++)o=i[r],t._processNotification(o);return i.length===t.size?t._check():void 0}}}(this))},t.prototype._processNotification=function(t){var e,r,n,o,i,s,a;return this.log&&console.log(t),e=t[0],r=t[1],a=t[2],s=t[3],o=App.Env.loco.getModelForRemoteName(e),n=o.getIdentity(),null!=App.IdentityMap.imap[n]&&(null!=App.IdentityMap.imap[n][r]&&(i=App.IdentityMap.find(n,r),null!=i.receivedSignal&&i.receivedSignal(a,s),this._emitSignalToMembers(r,a,s,o,n)),null!=o.receivedSignal&&o.receivedSignal(a,s),null!=App.IdentityMap.imap[n].collection&&0!==App.IdentityMap.imap[n].collection.length)?this._emitSignalToCollection(a,s,n):void 0},t.prototype._emitSignalToMembers=function(t,e,r,n,o,i){var s,a,l,u,p;for(null==i&&(i=null),null==i&&(i=new n({id:t})),u=App.IdentityMap.findConnected(o,t),p=[],a=0,l=u.length;l>a;a++)s=u[a],null!=s.receiverFor(i)?p.push(s[s.receiverFor(i)](e,r)):null!=s.receivedSignal?p.push(s.receivedSignal(e,r)):p.push(void 0);return p},t.prototype._emitSignalToCollection=function(t,e,r){var n,o,i,s,a;for(s=App.IdentityMap.imap[r].collection,a=[],n=0,o=s.length;o>n;n++)i=s[n],null!=i.receiverFor(r)?a.push(i[i.receiverFor(r)](r+" "+t,e)):null!=i.receivedSignal?a.push(i.receivedSignal(r+" "+t,e)):a.push(void 0);return a},t.prototype._requestParams=function(){var t;return t={synced_at:this.syncTime},null!=this.token&&(t.token=this.token),t},t.prototype._getURL=function(){var t,e,r,n,o;return n=window.location.href.split("/"),r=n[0],t=n[1],e=n[2],null!=this.protocolWithHost&&(o=this.protocolWithHost.split("//"),r=o[0],e=o[1]),null!=this.ssl&&(r=this.ssl?"https:":"http:"),r+"//"+e+"/"+this.location},t.prototype._handleDisconnection=function(){var t,e,r;return null==this.disconnectedSinceTime&&(this.disconnectedSinceTime=new Date),e=(new Date-this.disconnectedSinceTime)/1e3,t=null!=(r=App.Env.namespaceController)?r:App.Env.controller,e>this.allowedDisconnectionTime&&null!=t.disconnectedForTooLong?t.disconnectedForTooLong(this.disconnectedSinceTime):void 0},t}(),App.Loco=function(){function t(t){var e,r,n,o;null==t&&(t={}),this.wire=null,this.locale=null,this.initTurbolinks=!(null==t.turbolinks||!t.turbolinks),e=null!=t.notifications&&null!=t.notifications.enable&&t.notifications.enable,this.initWire=!!e,this.postInit=t.postInit,this.setLocale(null!=(n=t.locale)?n:"en"),this.setProtocolWithHost(t.protocolWithHost),r=null!=(o=t.notifications)?o:{},r.protocolWithHost=this.protocolWithHost,this.notificationsParams=r}return t.prototype.getWire=function(){return this.wire},t.prototype.getLocale=function(){return this.locale},t.prototype.setLocale=function(t){return this.locale=t},t.prototype.getProtocolWithHost=function(){return this.protocolWithHost},t.prototype.setProtocolWithHost=function(t){return null==t?void(this.protocolWithHost=null):("/"===t[t.length-1]&&(t=t.slice(0,+(t.length-2)+1||9e9)),this.protocolWithHost=t)},t.prototype.init=function(){return App.Env.loco=this,this.initWire&&(this.wire=new App.Wire(this.notificationsParams),this.wire.connect()),this.initTurbolinks?jQuery(document).on("page:change",function(t){return function(){return t.flow(),null!=t.postInit?t.postInit():void 0}}(this)):jQuery(function(t){return function(){return t.flow(),null!=t.postInit?t.postInit():void 0}}(this))},t.prototype.flow=function(){var t,e,r;return App.IdentityMap.clear(),r=$("body").data("namespace"),e=$("body").data("controller"),t=$("body").data("action"),App.Env.action=t,null!=App.Controllers[r]?(App.Env.namespaceController=new App.Controllers[r],null!=App.Controllers[r][e]&&(App.Env.controller=new App.Controllers[r][e]),null!=App.Env.namespaceController.initialize&&App.Env.namespaceController.initialize(),null!=App.Env.controller&&(App.Env.namespaceController.setSubController(App.Env.controller),App.Env.controller.setSuperController(App.Env.namespaceController),null!=App.Env.controller.initialize&&App.Env.controller.initialize(),null!=App.Env.controller[t]&&App.Env.controller[t]())):App.Controllers[e]&&(App.Env.controller=new App.Controllers[e],null!=App.Env.controller.initialize&&App.Env.controller.initialize(),null!=App.Env.controller[t]&&App.Env.controller[t]()),null!=this.wire?(this.wire.resetSyncTime(),this.wire._check()):void 0},t.prototype.getModels=function(){var t,e,r,n,o,i,s;n=[],s=/^[A-Z]/,o=App.Models;for(e in o)if(t=o[e],s.exec(e)&&"Base"!==e){n.push(e),i=App.Models[e];for(r in i)t=i[r],s.exec(r)&&n.push(e+"."+r)}return n},t.prototype.getModelForRemoteName=function(t){var e,r,n,o,i;for(i=this.getModels(),e=0,r=i.length;r>e;e++)if(n=i[e],o=n.split("."),1===o.length){if(App.Models[o[0]].getRemoteName()===t)return App.Models[o[0]]}else if(2===o.length&&App.Models[o[0]][o[1]].getRemoteName()===t)return App.Models[o[0]][o[1]]},t}(),App.Mixins.Connectivity=function(){function t(){}return t.prototype.connectWith=function(t,e){var r,n,o,i;if(null==e&&(e={}),null==t)return null;if("Array"!==t.constructor.name)return null!=e.receiver&&(this.receivers[t.toKey()]=e.receiver),App.IdentityMap.connect(this,{"with":t});for(i=App.Utils.Array.uniq(App.Utils.Array.map(t,function(t){return t.getIdentity()})),r=0,o=i.length;o>r;r++)n=i[r],App.IdentityMap.addCollection(n,{to:this}),null!=e.receiver&&(this.receivers[n]=e.receiver)},t.prototype.receiverFor=function(t){return"String"===t.constructor.name?null!=this.receivers[t]?this.receivers[t]:null:null!=this.receivers[t.toKey()]?this.receivers[t.toKey()]:null},t}(),App.Utils.Array=function(){function t(){}return t.map=function(t,e){var r,n,o,i;for(o=[],r=0,n=t.length;n>r;r++)i=t[r],o.push(e(i));return o},t.uniq=function(t){var e,r,n,o;for(n=[],e=0,r=t.length;r>e;e++)o=t[e],-1===n.indexOf(o)&&n.push(o);return n},t}(),App.Utils.Collection=function(){function t(){}return t.find=function(t,e){var r,n,o;for(r=0,n=t.length;n>r;r++)if(o=t[r],e(o)===!0)return o},t}(),App.Utils.String=function(){function t(){}return t.last=function(t){return t[t.length-1]},t}(),App.Validators.Base=function(){function t(){this.obj=null,this.attr=null,this.val=null,this.opts=null}return t.sharedInstances={},t.instance=function(t,e,r){var n,o;return o=this.name,null==this.sharedInstances[o]&&(this.sharedInstances[o]=new App.Validators[o]),n=this.sharedInstances[o],n.assignAttribs(t,e,r),n},t.prototype.assignAttribs=function(t,e,r){return this.obj=t,this.attr=e,this.val=this.obj[this.attr],this.opts=r},t}();var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Absence=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){switch(typeof this.val){case"string":if(null!=this.val&&0===this.val.length)return;break;default:if(null==this.val)return}return this._addErrorMessage()},e.prototype._addErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.present,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Confirmation=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){var t;return t=this.obj[this._properAttr()],null==this.val||null==t||this.val!==t?this._addErrorMessage():void 0},e.prototype._addErrorMessage=function(){var t,e,r,n;return r=this.attr.charAt(0).toUpperCase()+this.attr.slice(1),e=App.I18n[App.Env.loco.getLocale()].attributes[this.obj.getIdentity()],t=e&&e[this.attr]||r,n=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.confirmation,n=n.replace("%{attribute}",t),this.obj.addErrorMessage(n,{"for":this._properAttr()})},e.prototype._properAttr=function(){return this.attr+"Confirmation"},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Exclusion=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){var t;return t=this.opts["in"]||this.opts.within||[],-1!==t.indexOf(this.val)?this._addErrorMessage():void 0},e.prototype._addErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.exclusion,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Format=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){var t;return t=this.opts["with"].exec(this.val),null==t?this._addErrorMessage():void 0},e.prototype._addErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.invalid,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Inclusion=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){var t;return t=this.opts["in"]||this.opts.within||[],-1===t.indexOf(this.val)?this._addErrorMessage():void 0},e.prototype._addErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.inclusion,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Length=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){var t;if(null!=this.val&&(t=null!=this._range()[0]&&null!=this._range()[1]&&this._range()[0]===this._range()[1]&&this.val.length!==this._range()[0]?this._selectErrorMessage("wrong_length",this._range()[0]):null!=this._range()[0]&&this.val.length<this._range()[0]?this._selectErrorMessage("too_short",this._range()[0]):null!=this._range()[1]&&this.val.length>this._range()[1]?this._selectErrorMessage("too_long",this._range()[1]):null,null!==t))return this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._range=function(){var t,e;return t=this.opts.minimum||this.opts.is||null!=this.opts.within&&this.opts.within[0]||null,e=this.opts.maximum||this.opts.is||null!=this.opts.within&&this.opts.within[1]||null,[t,e]},e.prototype._selectErrorMessage=function(t,e){var r,n,o,i,s;if(1===e)return App.I18n[App.Env.loco.getLocale()].errors.messages[t].one;for(o=null,i=["few","many"],r=0,n=i.length;n>r;r++)if(s=i[r],this._checkVariant(s,e)){o=App.I18n[App.Env.loco.getLocale()].errors.messages[t][s];break}return null==o&&(o=App.I18n[App.Env.loco.getLocale()].errors.messages[t].other),null!=this.opts.message&&(o=this.opts.message),/%{count}/.exec(o)&&(o=o.replace("%{count}",e)),o},e.prototype._checkVariant=function(t,e){return null!=App.I18n[App.Env.loco.getLocale()].variants[t]?App.I18n[App.Env.loco.getLocale()].variants[t](e):void 0},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Numericality=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){return isNaN(this.val)?this._addNaNErrorMessage():null!=this.opts.only_integer&&Number(this.val)!==parseInt(this.val)?this._addIntErrorMessage():null!=this.opts.greater_than&&Number(this.val)<=this.opts.greater_than?this._addGreatherThanErrorMessage():null!=this.opts.greater_than_or_equal_to&&Number(this.val)<this.opts.greater_than_or_equal_to?this._addGreatherThanOrEqualToErrorMessage():null!=this.opts.equal_to&&Number(this.val)!==this.opts.equal_to?this._addEqualToErrorMessage():null!=this.opts.less_than&&Number(this.val)>=this.opts.less_than?this._addLessThanErrorMessage():null!=this.opts.less_than_or_equal_to&&Number(this.val)>this.opts.less_than_or_equal_to?this._addLessThanOrEqualToErrorMessage():null!=this.opts.other_than&&Number(this.val)===this.opts.other_than?this._addOtherThanErrorMessage():null!=this.opts.odd&&Number(this.val)%2!==1?this._addOddErrorMessage():null!=this.opts.even&&Number(this.val)%2!==0?this._addEvenErrorMessage():void 0},e.prototype._addNaNErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.not_a_number,this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addIntErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.not_an_integer,this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addGreatherThanErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.greater_than,t=t.replace("%{count}",this.opts.greater_than),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addGreatherThanOrEqualToErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.greater_than_or_equal_to,t=t.replace("%{count}",this.opts.greater_than_or_equal_to),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addEqualToErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.equal_to,t=t.replace("%{count}",this.opts.equal_to),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addLessThanErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.less_than,t=t.replace("%{count}",this.opts.less_than),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addLessThanOrEqualToErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.less_than_or_equal_to,t=t.replace("%{count}",this.opts.less_than_or_equal_to),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addOtherThanErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.other_than,t=t.replace("%{count}",this.opts.other_than),this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addOddErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.odd,this.obj.addErrorMessage(t,{"for":this.attr})},e.prototype._addEvenErrorMessage=function(){var t;return t=App.I18n[App.Env.loco.getLocale()].errors.messages.even,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Presence=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){switch(typeof this.val){case"string":if(null!=this.val&&this.val.length>0)return;break;default:if(null!=this.val)return}return this._addErrorMessage()},e.prototype._addErrorMessage=function(){var t;return t=null!=this.opts.message?this.opts.message:App.I18n[App.Env.loco.getLocale()].errors.messages.blank,this.obj.addErrorMessage(t,{"for":this.attr})},e}(App.Validators.Base);var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Validators.Size=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return extend(e,t),e.prototype.validate=function(){return App.Validators.Length.instance(this.obj,this.attr,this.opts).validate()},e}(App.Validators.Base),App.Models.Base=function(){function t(t){null==t&&(t={}),this.id=null,this.errors=null,this.resource=t.resource,null!=this.constructor.attributes&&this.__initAttributes(),null!=t&&this.__assignAttributes(t)}return t.all=function(t){return null==t&&(t={}),this.get("all",t)},t.find=function(t){var e,r,n;return n={},"object"==typeof t?(n=t,e=t.id,delete n.id):e=t,r=$.ajax({dataType:"json",method:"GET",url:this.__getResourcesUrl(n)+"/"+e,data:n}),new Promise(function(t){return function(e,n){return r.fail(function(t){return n(t)}),r.done(function(r){var n;return n=t.__initSubclass(r),App.IdentityMap.add(n),e(n)})}}(this))},t.get=function(t,e){return null==e&&(e={}),this.__send("GET",t,e)},t.post=function(t,e){return null==e&&(e={}),this.__send("POST",t,e)},t.put=function(t,e){return null==e&&(e={}),this.__send("PUT",t,e)},t["delete"]=function(t,e){return null==e&&(e={}),this.__send("DELETE",t,e)},t.getIdentity=function(){if(null!=this.identity)return this.identity;throw"Specify Model's @identity!"},t.getRemoteName=function(){return null!=this.remoteName?this.remoteName:this.getIdentity()},t.getAttribRemoteName=function(t){return null==this.attributes?null:null==this.attributes[t]?null:null==this.attributes[t].remoteName?t:this.attributes[t].remoteName},t.getResourcesUrlParams=function(){var t,e,r,n;for(n=this.__getResourcesUrl(),r=/:(\w+)\/?/,e=[];t=r.exec(n);)e.push(t[1]),n=n.replace(t[0],t[1]);return e},t.__getResourcesUrl=function(t){var e,r;return null==t&&(t={}),r=null==this.resources?"/"+this.getIdentity().toLowerCase()+"s":t.resource?this.resources[t.resource].url:null!=App.Env.scope&&null!=this.resources[App.Env.scope]?this.resources[App.Env.scope].url:this.resources.url,null!=App.Env.loco.protocolWithHost&&(r=""+App.Env.loco.protocolWithHost+r),e=/:(\w+)\/?/.exec(r),null==e?r:(null!=t[e[1]]?(r=r.replace(":"+e[1],t[e[1]]),delete t[e[1]]):null!=t.obj&&null!=t.obj[e[1]]&&(r=r.replace(":"+e[1],t.obj[e[1]])),r)},t.__initSubclass=function(t){var e;return null==t&&(t={}),e=this.getIdentity().split("."),1===e.length?new App.Models[e[0]](t):new App.Models[e[0]][e[1]](t)},t.__page=function(t,e,r,n){var o,i,s,a,l,u,p;if(null==e&&(e={}),null==r&&(r={}),null==n&&(n={resources:[],count:0}),i=r.method||"GET",u=r.url||this.__getResourcesUrl(e),o={},null!=r.data){l=r.data;for(a in l)p=l[a],"resource"!==a&&(o[a]=p)}return o[this.__getPaginationParam()]=t,s=$.ajax({dataType:"json",method:i,url:u,data:o}),new Promise(function(t){return function(r,o){return s.fail(function(t){return o(t)}),s.done(function(o){var i,s,l,u,c;n.count=o.count;for(a in o)p=o[a],-1===["resources","count"].indexOf(a)&&(n[a]=p);for(c=o.resources,i=0,s=c.length;s>i;i++)u=c[i],l=t.__initSubclass(u),null!=e.resource&&(l.resource=e.resource),App.IdentityMap.add(l),n.resources.push(l);return r(n)})}}(this))},t.__paginate=function(t,e){var r,n,o;return n=this.__getPaginationPer(),r=null!=(o=t.page)?o:1,this.__page(r,t,e).then(function(r){return function(o){var i,s,a,l,u,p;if(null!=t.page)return Promise.resolve(o);if(o.count<=n)return Promise.resolve(o);if(l=parseInt(o.count/n),l!==o.count/n&&(l+=1),u=Promise.resolve(o),1===l)return u;for(s=a=2,p=l;p>=2?p>=a:a>=p;s=p>=2?++a:--a)(i=function(n){return u=u.then(function(i){return r.__page(n,t,e,o)})})(s);return u}}(this))},t.__getPaginationParam=function(){var t,e,r,n,o;return null!=(null!=(e=this.resources)&&null!=(r=e.paginate)?r.page:void 0)?this.resources.paginate.page:null!=App.Env.scope&&null!=this.resources&&null!=this.resources[App.Env.scope]&&(t=null!=(n=this.resources[App.Env.scope])&&null!=(o=n.paginate)?o.param:void 0,null!=t)?t:null!=this.paginate&&null!=this.paginate.param?this.paginate.param:"page"},t.__getPaginationPer=function(){var t,e,r,n,o;return null!=App.Env.scope&&null!=this.resources&&null!=this.resources[App.Env.scope]&&(t=null!=(e=this.resources[App.Env.scope])&&null!=(r=e.paginate)?r.per:void 0,null!=t)?t:null!=(null!=(n=this.resources)&&null!=(o=n.paginate)?o.per:void 0)?this.resources.paginate.per:null!=this.paginate&&null!=this.paginate.per?this.paginate.per:null},t.__send=function(t,e,r){var n,o;return o=this.__getResourcesUrl(r),"all"!==e&&(o=o+"/"+e),n={method:t,url:o,data:r},this.__paginate(r,n)},t.prototype.setResource=function(t){return this.resource=t},t.prototype.getIdentity=function(){var t;return t=this.constructor.identity,null!=t?t:this.constructor.name},t.prototype.getRemoteName=function(t){return null==this.constructor.attributes?null:null==this.constructor.attributes[t]?null:this.constructor.attributes[t].remoteName||t},t.prototype.getAttrRemoteName=function(t){return this.getRemoteName(t)},t.prototype.getAttrName=function(t){var e,r,n;if(null==this.constructor.attributes)return t;if(null!=this.constructor.attributes[t])return t;n=this.constructor.attributes;for(r in n)if(e=n[r],e.remoteName===t)return r;return t},t.prototype.getAttrType=function(t){return null==this.constructor.attributes?null:null==this.constructor.attributes[t]?null:this.constructor.attributes[t].type},t.prototype.assignAttr=function(t,e){var r;if(r=this.getAttrType(t),null==e)return void(this[t]=null);switch(r){case"Date":e=new Date(Date.parse(e));break;case"Integer":case"Int":e=parseInt(e);break;case"Float":e=parseFloat(e);break;case"Boolean":case"Bool":e=Boolean(parseInt(e));break;case"Number":e=Number(e);break;case"String":e=String(e)}return this[t]=e},t.prototype.attributes=function(){var t,e,r,n;if(e={id:this.id},null==this.constructor.attributes)return e;n=this.constructor.attributes;for(r in n)t=n[r],e[r]=this[r];return e},t.prototype.isValid=function(){var t,e,r,n,o,i,s,a,l,u,p,c;if(null==this.constructor.attributes)return!0;this.errors=null,s=this.constructor.attributes;for(o in s)if(t=s[o],null!=t.validations){a=t.validations;for(u in a)p=a[u],null!=this.id&&"create"===p.on||null==this.id&&"update"===p.on||(null==p["if"]||p["if"](this))&&(c=u.charAt(0).toUpperCase()+u.slice(1),null!=App.Validators[c]?(i=this.__processedValidationSettings(p),App.Validators[c].instance(this,o,i).validate()):console.log('Warning! "'+c+'" validator is not implemented!'))}if(null!=this.constructor.validate)for(l=this.constructor.validate,e=0,r=l.length;r>e;e++)n=l[e],this[n]();return null==this.errors},t.prototype.isInvalid=function(){return!this.isValid()},t.prototype.isEmpty=function(){var t,e,r;e=this.attributes();for(t in e)if(r=e[t],null!==this[t])return!1;return!0},t.prototype.addErrorMessage=function(t,e){return null==e&&(e={}),null==this.errors&&(this.errors={}),null==this.errors[e["for"]]&&(this.errors[e["for"]]=[]),this.errors[e["for"]].push(t)},t.prototype.save=function(){var t;return t=$.ajax({dataType:"json",method:null!=this.id?"PUT":"POST",url:this.__getResourceUrl(),data:this.serialize()}),new Promise(function(e){return function(r,n){return t.fail(function(t){return n(t)}),t.done(function(t){return t.success?void r(t):(null!=t.errors&&e.__assignRemoteErrorMessages(t.errors),r(t))})}}(this))},t.prototype.updateAttribute=function(t){var e;return e=$.ajax({dataType:"json",method:"PUT",url:this.__getResourceUrl(),data:this.serialize(t)}),new Promise(function(t){return function(r,n){return e.fail(function(t){return n(t)}),e.done(function(e){return e.success?void r(e):(null!=e.errors&&t.__assignRemoteErrorMessages(e.errors),r(e))})}}(this))},t.prototype.serialize=function(t){var e,r,n,o,i;if(null==t&&(t=null),null==this.constructor.attributes)return{};n={},o=this.constructor.getRemoteName().toLowerCase(),n[o]={},r={},null!=t?r[t]=null:r=this.constructor.attributes;for(t in r)e=r[t],i=this.getRemoteName(t),n[o][i]=this[t];return n},t.prototype.reload=function(){var t,e,r,n,o;for(t={id:this.id},o=this.constructor.getResourcesUrlParams(),e=0,r=o.length;r>e;e++)n=o[e],t[n]=this[n];return this.constructor.find(t)},t.prototype.changes=function(){var t,e,r,n,o;n={},t=App.IdentityMap.find(this.getIdentity(),this.id),r=this.attributes();for(e in r)if(o=r[e],o!==t[e]){if(o.constructor===Date&&t[e]-o===0)continue;o!==t[e]&&(n[e]={is:t[e],was:o})}return n},t.prototype.applyChanges=function(){var t,e,r,n;e=this.changes(),r=[];for(t in e)n=e[t],r.push(this[t]=n.is);return r},t.prototype.toKey=function(){return this.getIdentity().toLowerCase()+"_"+this.id},t.prototype.get=function(t,e){return null==e&&(e={}),this.__send("GET",t,e)},t.prototype.post=function(t,e){return null==e&&(e={}),this.__send("POST",t,e)},t.prototype.put=function(t,e){return null==e&&(e={}),this.__send("PUT",t,e)},t.prototype["delete"]=function(t,e){return null==e&&(e={}),this.__send("DELETE",t,e)},t.prototype.__send=function(t,e,r){var n,o;return o=this.__getResourceUrl(),null!=e&&(o=o+"/"+e),n=$.ajax({dataType:"json",method:t,url:o,data:r}),new Promise(function(t,e){return n.fail(function(t){return e(t)}),n.done(function(e){return t(e)})})},t.prototype.__assignAttributes=function(t){var e,r,n,o;n=[];for(r in t)o=t[r],e=this.getAttrName(r),n.push(this.assignAttr(e,o));return n},t.prototype.__initAttributes=function(){var t,e,r,n;r=this.constructor.attributes,n=[];for(e in r)t=r[e],n.push(this[e]=null);return n},t.prototype.__assignRemoteErrorMessages=function(t){var e,r,n,o,i;i=[];for(o in t)n=t[o],e=this.getAttrName(o),i.push(function(){var t,o,i;for(i=[],t=0,o=n.length;o>t;t++)r=n[t],i.push(this.addErrorMessage(r,{"for":e}));return i}.call(this));return i},t.prototype.__getResourceUrl=function(){var t;return t=this.constructor.__getResourcesUrl({resource:this.resource,obj:this}),null==this.id?t:t+"/"+this.id},t.prototype.__processedValidationSettings=function(t){var e,r,n;n={};for(e in t)r=t[e],"function"==typeof r?n[e]=r(this):n[e]=r;return n},t}();var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Controllers.Base=function(t){function e(){this.views={},this.receivers={},this.subController=null,this.superController=null,this.params=this.__fetchParams()}return extend(e,t),e.prototype.setView=function(t,e){return this.views[t]=e},e.prototype.getView=function(t){return this.views[t]},e.prototype.getViews=function(){return this.views},e.prototype.setSubController=function(t){return this.subController=t},e.prototype.getSubController=function(){return this.subController},e.prototype.setSuperController=function(t){return this.superController=t},e.prototype.getSuperController=function(){return this.superController},e.prototype.setResource=function(t){return this.setScope(t)},e.prototype.setScope=function(t){return App.Env.scope=t},e.prototype.__fetchParams=function(){var t,e,r,n,o,i,s,a,l,u,p;if(s={},i=/https?:\/\/.+\/\w+\/(\d+)/.exec(window.location.href),r=null!=i?i[1]:null,null!=r&&(s.id=parseInt(r)),u=window.location.href.split("?"),1===u.length)return s;for(l=u[u.length-1],a=App.Utils.Array.map(l.split("&"),function(t){return t.split("=")}),e=0,o=a.length;o>e;e++)t=a[e],n=decodeURIComponent(t[0]),p=decodeURIComponent(t[1]),null!=p&&(p=p.replace(/\+/g," ")),s[n]=p;return s},e}(App.Mix(App.Mixins.Connectivity));var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;App.Views.Base=function(t){function e(t){null==t&&(t={}),this.views={},this.intervals={},this.receivers={},this.controller=null,this.delegator=null,null!=t.controller&&this.setController(t.controller),null!=t.delegator&&this.setDelegator(t.delegator)}return extend(e,t),e.prototype.setController=function(t){return this.controller=t},e.prototype.getController=function(){return this.controller},e.prototype.setView=function(t,e){return this.views[t]=e},e.prototype.getView=function(t){return this.views[t]},e.prototype.getViews=function(){
return this.views},e.prototype.setDelegator=function(t){return this.delegator=t},e.prototype.getDelegator=function(t){return this.delegator},e}(App.Mix(App.Mixins.Connectivity)),App.UI.Form=function(){function t(t){null==t&&(t={}),this.formId=t.id,this.obj=t["for"],this.initObj=!(null==t.initObj||!t.initObj),this.delegator=t.delegator,this.callbackSuccess=t.callbackSuccess,this.callbackFailure=t.callbackFailure,this.callbackActive=t.callbackActive,this.form=this._findForm(),this.submit=this.form.find(":submit"),this.submitVal=this.submit.val(),this.locale=App.Env.loco.getLocale()}return t.prototype.getObj=function(){return this.obj},t.prototype.render=function(){return this.initObj?this._assignAttribs():this.fill(),this._handle()},t.prototype.fill=function(t){var e,r,n,o,i,s,a,l;if(null==t&&(t=null),null==this.obj)return null;if(null==this.obj.constructor.attributes)return null;r={},null!=t?r[t]=null:r=this.obj.constructor.attributes,a=[];for(o in r)e=r[o],s=this.obj.getAttrRemoteName(o),n=this.form.find("[data-attr="+s+"]").find("input,textarea,select"),1!==n.length?(l=App.Utils.Array.uniq(App.Utils.Array.map(n,function(t){return $(t).attr("type")})),1!==l.length||"radio"!==l[0]||(i=App.Utils.Collection.find(n,function(t){return function(e){return $(e).val()===String(t.obj[o])}}(this)),null==i)?"hidden"!==n.first().attr("type")&&"checkbox"!==n.last().attr("type")||a.push(n.last().prop("checked",Boolean(this.obj[o]))):$(i).prop("checked",!0)):n.val(this.obj[o]);return a},t.prototype._findForm=function(){var t;return null!=this.formId?$("#"+this.formId):null!=this.obj?(t=this.obj.getIdentity().toLowerCase(),null!=this.obj.id?$("#edit_"+t+"_"+this.obj.id):$("#new_"+t)):void 0},t.prototype._handle=function(){return this.form.on("submit",function(t){return function(e){var r;return e.preventDefault(),t._canBeSubmitted()?null==t.obj?void t._submitForm():(t._assignAttribs(),t._hideErrors(),t.obj.isInvalid()?(t._renderErrors(),void(null!=t.callbackFailure&&t.delegator[t.callbackFailure]())):(t._submittingForm(!1),r=null==t.obj.id,t.obj.save().then(function(e){return e.success?t._handleSuccess(e,r):(null!=t.callbackFailure&&t.delegator[t.callbackFailure](),t._renderErrors())})["catch"](function(e){return t._connectionError()}))):void 0}}(this))},t.prototype._canBeSubmitted=function(){return this.submit.hasClass("active")?!1:this.submit.hasClass("success")?!1:!this.submit.hasClass("failure")},t.prototype._submitForm=function(){var t,e;return this._submittingForm(),e=this.form.attr("action")+".json",t=$.post(e,this.form.serialize()),t.always(function(t){return function(){return t.submit.removeClass("active").blur()}}(this)),t.fail(function(t){return function(){return t._connectionError()}}(this)),t.done(function(t){return function(e){return e.success?t._handleSuccess(e,"POST"===t.form.attr("method")):t._renderErrors(e.errors)}}(this))},t.prototype._handleSuccess=function(t,e){var r,n,o;return null==e&&(e=!0),o=null!=(r=null!=(n=t.flash)?n.success:void 0)?r:App.I18n[this.locale].ui.form.success,this.submit.removeClass("active").addClass("success").val(o),null!=t.access_token&&App.Env.loco.getWire().setToken(t.access_token),null!=this.callbackSuccess?void(null!=t.data?this.delegator[this.callbackSuccess](t.data):this.delegator[this.callbackSuccess]()):setTimeout(function(t){return function(){var r;return t.submit.removeClass("success").val(t.submitVal),r=":not([data-loco-not-clear=true])",e?t.form.find("input:not([type='submit'])"+r+", textarea"+r).val(""):void 0}}(this),5e3)},t.prototype._renderErrors=function(t){var e,r,n,o;if(null==t&&(t=null),!(null!=this.obj&&null==this.obj.errors||null==this.obj&&null==t)){r=null!=t?t:this.obj.errors;for(e in r)n=r[e],o=null!=this.obj?this.obj.getAttrRemoteName(e):e,null==o||"base"===e?"base"===e&&n.length>0&&(1===$(".errors[data-for='base']").length?$(".errors[data-for='base']").text(n[0]):this.submit.val(n[0])):this.form.find("[data-attr="+o+"]").find(".errors[data-for="+o+"]").text(n[0]);return this.submit.val()!==this.submitVal&&this.submit.val()!==App.I18n[this.locale].ui.form.sending||this.submit.val(App.I18n[this.locale].ui.form.errors.invalid_data),this.submit.removeClass("active").addClass("failure"),this._showErrors(),setTimeout(function(t){return function(){return t.submit.removeClass("failure").val(t.submitVal),t.form.find("input.invalid, textarea.invalid, select.invalid").removeClass("invalid")}}(this),1e3)}},t.prototype._assignAttribs=function(){var t,e,r,n,o,i,s,a;if(null==this.obj.constructor.attributes)return null;o=this.obj.constructor.attributes,s=[];for(r in o)t=o[r],i=this.obj.getAttrRemoteName(r),e=this.form.find("[data-attr="+i+"]").find("input,textarea,select"),1!==e.length?(a=App.Utils.Array.uniq(App.Utils.Array.map(e,function(t){return $(t).attr("type")})),1!==a.length||"radio"!==a[0]||(n=App.Utils.Collection.find(e,function(t){return function(t){return $(t).is(":checked")}}(this)),null==n)?"hidden"!==e.first().attr("type")&&"checkbox"!==e.last().attr("type")||(e.last().is(":checked")?s.push(this.obj.assignAttr(r,e.last().val())):s.push(this.obj.assignAttr(r,e.first().val()))):this.obj.assignAttr(r,$(n).val())):this.obj.assignAttr(r,e.val());return s},t.prototype._hideErrors=function(){return this.form.find(".errors").each(function(t){return function(t,e){return $(e).text().trim().length>0?($(e).text(""),$(e).hide()):void 0}}(this))},t.prototype._showErrors=function(){return this.form.find(".errors").each(function(t){return function(t,e){return $(e).text().trim().length>0?$(e).show():void 0}}(this))},t.prototype._submittingForm=function(t){return null==t&&(t=!0),this.submit.removeClass("success").removeClass("failure").addClass("active").val(App.I18n[this.locale].ui.form.sending),null!=this.callbackActive&&this.delegator[this.callbackActive](),t?this._hideErrors():void 0},t.prototype._connectionError=function(){return this.submit.removeClass("active").addClass("failure").val(App.I18n[this.locale].ui.form.errors.connection),setTimeout(function(t){return function(){return t.submit.removeClass("failure").val(t.submitVal)}}(this),3e3)},t}(),App.UI.Tabs=function(){function t(t,e,r){var n;null==r&&(r={}),this.sel=$(t),this.delegator=e,this.animFunc=null!=(n=r.animFunc)?n:"animate",this.handle()}return t.prototype.handle=function(){var t;return t=this.sel.find("a").size(),this.sel.find("a").click(function(e){return function(r){var n,o,i,s,a,l,u;if(r.preventDefault(),!$(r.target).hasClass("active")){for(i=0,l=$(r.target).parent().children("a"),o=0,a=l.length;a>o&&(n=l[o],$(n).text()!==$(r.target).text());o++)i+=1;return u=parseInt(e.sel.css("width")),s=u/t*i,e.sel.find("a.active").removeClass("active"),$(r.target).addClass("active"),e.sel.find("div.background")[e.animFunc]({left:s},200),e.delegator[$(r.target).data("action")]()}}}(this))},t}(),App.Services.Date=function(){function t(t){this.date=t}return t.prototype.toString=function(t){var e;switch(null==t&&(t="default"),e=App.I18n[App.Env.loco.getLocale()].date.formats,t){case"default":return this.strftime(e["default"]);case"short":return this.strftime(e["short"]);case"long":return this.strftime(e["long"]);default:return console.log("App.Services.Date#toString: unknown format.")}},t.prototype.strftime=function(t){var e;return e=App.I18n[App.Env.loco.getLocale()],t=t.replace("%Y",function(t){return function(e){return t.date.getFullYear()}}(this)),t=t.replace("%y",function(t){return function(e){return t.date.getFullYear().toString().slice(-2)}}(this)),t=t.replace("%m",function(t){return function(e){var r;return r=t.date.getMonth()+1,r>=10?r:"0"+r}}(this)),t=t.replace("%b",function(t){return function(r){return e.date.abbr_month_names[t.date.getMonth()]}}(this)),t=t.replace("%B",function(t){return function(r){return e.date.month_names[t.date.getMonth()]}}(this)),t=t.replace("%d",function(t){return function(e){return t.date.getDate()>=10?t.date.getDate():"0"+t.date.getDate()}}(this)),t=t.replace("%H",function(t){return function(e){return t.date.getHours()>=10?t.date.getHours():"0"+t.date.getHours()}}(this)),t=t.replace("%M",function(t){return function(e){return t.date.getMinutes()>=10?t.date.getMinutes():"0"+t.date.getMinutes()}}(this))},t}(),App.Helpers.Text=function(){function t(t){null==t&&(t={})}return t.prototype.simpleFormat=function(t){return t=t.replace(/\r\n?/,"\n"),t=$.trim(t),t.length>0&&(t=t.replace(/\n\n+/g,"</p><p>"),t=t.replace(/\n/g,"<br>"),t="<p>"+t+"</p>"),t},t}(),App.I18n.en={variants:{},models:{},attributes:{},ui:{form:{sending:"Sending...",success:"Success",errors:{connection:"Connection Error",invalid_data:"Invalid data"}}},date:{formats:{"default":"%Y-%m-%d","short":"%b %d","long":"%B %d, %Y"},day_names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr_day_names:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr_month_names:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},errors:{messages:{accepted:"must be accepted",blank:"can't be blank",confirmation:"doesn't match %{attribute}",empty:"can't be empty",equal_to:"must be equal to %{count}",even:"must be even",exclusion:"is reserved",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",inclusion:"is not included in the list",invalid:"is invalid",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_a_number:"is not a number",not_an_integer:"must be an integer",odd:"must be odd",present:"must be blank",too_long:{one:"is too long (maximum is 1 character)",other:"is too long (maximum is %{count} characters)"},too_short:{one:"is too short (minimum is 1 character)",other:"is too short (minimum is %{count} characters)"},wrong_length:{one:"is the wrong length (should be 1 character)",other:"is the wrong length (should be %{count} characters)"},other_than:"must be other than %{count}"}}};